<%= render partial: 'shared/navigations/administration' if can?(:administrate, :application) && current_community %>
<nav class="navbar navbar-default navbar-static-top navbar-member">
  <div class="container">
    <div class="navbar-header">
      <button aria-controls="navbar" aria-expanded="false" class="navbar-toggle collapsed" data-target="#navbar" data-toggle="collapse" type="button">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <%= link_to root_path, class: 'navbar-brand' do %>
        <% if current_community.present? %>
          <span class='community-brand'><%= current_community.name %></span>
        <% else %>
          <strong>my</strong>Magic Communities
        <% end %>
      <% end %>
    </div>
    <% if member_signed_in? %>
      <div class="navbar-collapse collapse" id="navbar">
        <ul class="nav navbar-nav">
          <% if current_community %>
            <%= nav_link "Discussions", [current_community, Discussion] if can? :read, Discussion %>
            <%= nav_link "Members", [current_community, Member] if can? :read, Member %>
            <%= nav_link "Companies", [current_community, Company] if can? :read, Company %>
            <%= nav_link "Events", community_calendar_path(current_community) if can? :read, :calendar %>
            <% if can? :read, Message %>
              <%= nav_link [current_community, current_member.last_chat_participant, Message] do %>
                <% if unread_messages.present? %>
                  Messages <span class="badge"><%= unread_messages.size %></span>
                <% else %>
                  Messages
                <% end %>
              <% end %>
            <% end %>
          <% else %>
            <%= nav_link "Welcome", root_path %>
          <% end %>
        </ul>
        <ul class="nav navbar-nav navbar-right">
          <li class="dropdown">
            <a aria-expanded="false" class="dropdown-toggle" data-toggle="dropdown" href="#" role="button">
              <%= image_tag(current_member.avatar.url(:icon), class: 'img-rounded') %>
              <span class="caret"></span>
            </a>
            <ul class="dropdown-menu" role="menu">
              <% if current_member.companies.any? %>
                <% current_member.companies.each do |company| %>
                  <%= nav_link company.name, community_company_path(current_community, company) %>
                <% end %>
                <li class="divider"></li>
              <% end %>
              <%= nav_link "#{ current_member.full_name }'s Profile", community_member_path(current_community, current_member) %>
              <%= nav_link "Preferences", edit_member_registration_path(current_community) %>
              <% if can? :read, Message %>
                <%= nav_link [current_community, current_member.last_chat_participant, Message] do %>
                    Messages
                    <%= content_tag('span', unread_messages.size, class: 'badge') if unread_messages.present? %>
                <% end %>
              <% end %>
              <%= nav_link "Sign out", destroy_member_session_path(current_community), method: :delete %>
            </ul>
          </li>
        </ul>
      </div>
    <% else %>
      <div class="navbar-collapse collapse" id="navbar">
        <ul class="nav navbar-nav navbar-right">
          <% if current_community %>
            <%= nav_link "Log in", new_member_session_path(current_community) %>
          <% end %>
        </ul>
      </div>
    <% end %>
  </div>
</nav>
